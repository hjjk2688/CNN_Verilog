# 3. 양자화 전략 및 하드웨어 최적화 (Quantization Strategy & Hardware Optimization)

## 3.1. 개요 (Overview)

본 프로젝트는 FPGA의 제한된 리소스를 효율적으로 활용하기 위해 CNN 가속기에 **INT8 대칭 양자화(Symmetric Quantization)** 기법을 적용하였다. 양자화 과정에서 필수적인 스케일링(Re-scaling) 연산을 수행함에 있어, 일반적인 딥러닝 프레임워크가 사용하는 '레이어 별 동적 스케일링' 방식과 본 프로젝트의 입력 특성을 고려한 '고정 스케일링' 방식을 비교 분석하고, 최종적으로 하드웨어 복잡도를 최소화하는 **시스템 인지 최적화(System-Aware Optimization)** 설계를 채택하였다.

## 3.2. 이론적 배경: 표준 양자화 방식 (Standard QAT/PTQ)

일반적인 CNN 모델(ResNet, MobileNet 등)에서 각 레이어의 가중치(Weight)와 활성화 값(Activation)은 층마다 서로 다른 분포(Distribution) 범위를 가진다. 따라서 데이터의 정확도 손실을 최소화하기 위해 **레이어 별로 독립적인 스케일 팩터(Scale Factor)**를 계산하여 적용하는 것이 정석이다.

* **스케일 팩터() 정의:**



(: 실수 데이터, : INT8의 최대값)
* **재양자화(Re-quantization) 연산:**
컨볼루션 연산 결과(INT32)를 다음 층의 입력(INT8)으로 변환할 때, 입력/가중치/출력의 스케일 비율을 맞추기 위해 실수 연산기(Multiplier)가 필요하다.



이 방식은 **범용성과 정확도가 우수**하나, 하드웨어 구현 시 **부동소수점 연산 혹은 복잡한 고정소수점 곱셈기(DSP) 자원을 다수 소모**한다는 단점이 있다.

## 3.3. 제안하는 방식: 입력 데이터 기반 고정 스케일링 (Proposed Method)

### 3.3.1. 시스템 환경 분석

본 프로젝트의 입력 데이터는 터치패드를 통해 생성된 **이진화된 이미지(Binary Image)**이다.

1. **입력 데이터의 결정론적 특성:** 입력 픽셀 값은 배경(0) 또는 글씨(1)로 고정되어 있으며, 일반적인 카메라 이미지와 달리 중간 계조(Gray-scale)나 노이즈가 존재하지 않는다.
2. **데이터 분포의 안정성:** 입력 데이터의 분포가 일정하므로, 레이어가 깊어져도 활성화 값의 범위가 급격하게 변동하지 않는 특성을 보인다.

### 3.3.2. 최적화 설계 (Optimization)

위의 분석을 바탕으로 복잡한 승산기(Multiplier)를 제거하고 **비트 시프트(Bit-shift)만으로 스케일링을 수행**하는 경량화 구조를 설계하였다.

1. **전처리 단계 (Pre-processing Scaling):**
입력 데이터의 최대값(1.0)을 INT8 최대값인 127에 매핑하기 위해 소프트웨어 단에서 전처리를 수행한다.



이는 수식적으로 스케일 팩터 을 적용한 것과 동일하다.
2. **고정 비트 시프트 (Fixed Bit-Shift):**
입력과 가중치 모두 127 스케일()을 기준으로 양자화되었으므로, 컨볼루션 연산 결과는  스케일을 갖는다. 이를 다시  스케일로 환원하기 위해 **우측 시프트 7회(`>>> 7`)** 연산을 적용한다.




## 3.4. 비교 분석 및 성능 평가 (Comparative Analysis)

제안하는 방식과 표준 방식의 하드웨어 리소스 및 연산 효율성을 비교하면 다음과 같다.

| 비교 항목 | 표준 방식 (Standard Approach) | **제안하는 방식 (Proposed Approach)** |
| --- | --- | --- |
| **스케일링 기법** | Per-Layer Dynamic Scaling (층별 가변) | **Fixed Scaling (전역 고정)** |
| **핵심 연산 장치** | 곱셈기 (Multiplier / DSP) 필요 | **시프터 (Shifter) 만으로 구성** |
| **구현 복잡도** | 높음 (별도의 스케일 팩터 메모리 필요) | **매우 낮음 (Hard-wired Logic)** |
| **리소스 소모** | DSP 및 LUT 사용량 높음 | **LUT 사용량 최소화, DSP 미사용** |
| **적합성** | 범용 이미지 (ImageNet, CIFAR 등) | **특수 목적 입력 (MNIST 터치패드 등)** |

## 3.5. 결론 (Conclusion)

본 프로젝트에서는 MNIST 데이터셋의 특성과 터치패드 입력이라는 시스템 환경을 고려하여 **고정 스케일링(Fixed Scaling)** 방식을 채택하였다. 이를 통해 표준 양자화 방식 대비 **수학적 정합성을 유지하면서도 FPGA의 DSP 자원 사용을 배제하고 연산 지연(Latency)을 단축**하는 성과를 거두었다. 이는 단순한 기능 구현을 넘어, **임베디드 시스템의 제약을 고려한 하드웨어 최적화(Hardware-Software Co-design)**의 모범적인 사례라 할 수 있다.



